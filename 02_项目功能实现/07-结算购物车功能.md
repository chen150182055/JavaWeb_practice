## 结算购物车功能

* 结算购物车功能的实现的话分为两步，产生订单信息，将订单信息记录到订单表中，然后显示对应的订单页面 让用户进行结算


  * 编写插入详细订单信息的dao方法:OrderItemDao

    ```java
     /**
         * 添加订单中商品的方法
         * @param orderItem
         * @return
         */
        public int addOrderItem(OrderItem orderItem){
    	String sql="insert into OrderItem values(?,?,?,?,?)";
    	Object[] arr={orderItem.getItemId(),orderItem.getCount(),orderItem.getSubtotal(),
    			orderItem.getProduct().getPid(),orderItem.getOid()};
    	int n=0;
    	try {
    		n = qr.update(sql,arr);
    	} catch (SQLException e) {
    		e.printStackTrace();
    	}
    	return n;	
        }
    ```
  
  * 编写完dao方法后创建(SubmitOrderServlet)
  
    ```java
    protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
    		
    ```

  			//用户在登录的情况下 才能提交订单
    		HttpSession session = request.getSession();
  			User user = (User)session.getAttribute("user");
    		
  			//如果用户没有登陆的话 就登录
    		if(user==null) {
    			response.sendRedirect("login.jsp");
    		}
    		//处理订单信息
    		else {
    			//生成订单信息
    			Order order = new Order();
    			order.setOid(UUID.randomUUID().toString());
    			order.setName(user.getName());
    			order.setUid(user.getUid());
    			
    			
    			//订单中还有这个购物车的商品
    			//获取购物车
    			Cart cart=(Cart)session.getAttribute("cart");
    			
    			ArrayList<OrderItem> orderItems = new ArrayList<>();  //定义一个集合用来存放购物中的商品
    			
    			Set<Entry<String,CartItem>> entrySet = cart.getCartItems().entrySet();  //获取所有购物中的详细商品信息
    			for (Entry<String, CartItem> entry : entrySet) {
    				//因为一个订单中有多个商品 我们需要将商品写入数据
    				OrderItem orderItem = new OrderItem();
    				orderItem.setItemId(UUID.randomUUID().toString());
    				orderItem.setCount(entry.getValue().getBuyNum());
    				orderItem.setProduct(entry.getValue().getProduct());
    				orderItem.setOid(order.getOid());   //通过oid 订单编号 来判断这个商品时属于哪个订单下面的
    				orderItems.add(orderItem);  //将取出的内容存放到这个集合中
    			}
    			
    			order.setOrderItems(orderItems);
    			
    			//提交订单后进入的是订单确定页面
    			request.setAttribute("order", order);
    			request.getRequestDispatcher("order_info.jsp").forward(request, response);
    			
    		}
    	}
    ```

  * 删除这个页面的   “删除订单” 按钮